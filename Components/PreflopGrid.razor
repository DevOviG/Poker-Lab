@namespace PokerLabBlazor.Components
@using PokerLabBlazor.Logic

<div class="flex flex-col items-center justify-center p-6 bg-slate-50 border-b border-slate-200">
    <h1 class="text-3xl font-bold text-slate-800 mb-4 uppercase tracking-wider">Preflop Engine</h1>
    <div class="flex gap-2 bg-slate-200 p-1 rounded-lg">
        @foreach (string pos in new[] { "UTG", "HJ", "CO", "BTN", "SB" })
        {
            <button class="px-4 py-2 rounded text-sm font-bold transition-all @GetButtonClass(pos)"
                    @onclick="() => SetPosition(pos)">
                @pos
            </button>
        }
    </div>
</div>

<div class="flex flex-col lg:flex-row gap-8 max-w-6xl mx-auto p-6 items-start">
    <div class="w-full lg:w-2/3">
        <div class="grid grid-cols-[repeat(13,1fr)] gap-[1px] bg-slate-300 p-[2px] rounded shadow-sm max-w-[600px] mx-auto">
            @for (int row = 0; row < 13; row++)
            {
                @for (int col = 0; col < 13; col++)
                {
                    int r = row; int c = col;
                    // Updated to use Core and Preflop logic classes
                    string hand = Core.GetHandName(r, c);
                    bool isOpen = Preflop.IsHandInRange(hand, currentPos);

                    <div class="aspect-square flex items-center justify-center text-[10px] sm:text-xs font-bold cursor-pointer transition hover:scale-110 border border-transparent 
                                @(isOpen ? "bg-emerald-500 text-white" : "bg-white text-slate-300")"
                         @onclick="() => SelectHand(hand, isOpen)">
                        @hand
                    </div>
                }
            }
        </div>
    </div>
    
    <div class="w-full lg:w-1/3 space-y-4">
        <div class="bg-slate-800 text-white p-6 rounded-lg shadow-lg border-l-4 border-emerald-500 min-h-[150px]">
            @if (string.IsNullOrEmpty(selectedHand))
            {
                <p class="text-slate-400 italic">Click a hand to see details...</p>
            }
            else
            {
                <h2 class="text-2xl font-bold text-emerald-400 mb-2">@selectedHand</h2>
                @if (isSelectedHandOpen)
                {
                    <p class="text-lg">✅ <span class="font-bold">OPEN RAISE</span> from @currentPos</p>
                }
                else
                {
                    <p class="text-lg text-slate-400">❌ <span class="font-bold">FOLD</span> from @currentPos</p>
                }
            }
        </div>
    </div>
</div>

@code {
    private string currentPos = "UTG";
    private string selectedHand = "";
    private bool isSelectedHandOpen = false;

    private void SetPosition(string pos)
    {
        currentPos = pos;
        selectedHand = "";
    }

    private void SelectHand(string hand, bool isOpen)
    {
        selectedHand = hand;
        isSelectedHandOpen = isOpen;
    }

    private string GetButtonClass(string pos)
    {
        if (currentPos == pos) return "bg-emerald-600 text-white shadow-sm";
        return "bg-transparent text-slate-600 hover:text-slate-900";
    }
}